---
layout: post
categories: network
title: 下载某个国家所有的IP地址CIDR
date: 2025-05-28 20:21:00 +07:00
---
一般需要限制某个国家访问时需要的一个IP地址列表\
首先下载免费数据库https://db-ip.com/db/lite.php

步骤1：按国家拆分 IP 范围文件
```
<?php

$inputFile = 'dbip/dbip-country-lite-2025-05.csv';
$inputFile = 'dbip/ip2country-v4.tsv';
$tmpDir = __DIR__ . '/country-ipv4-range';

if (!is_dir($tmpDir)) mkdir($tmpDir);

// 把 IP 范围按国家写入临时文件
$fp = fopen($inputFile, 'r');
while (($line = fgets($fp)) !== false) {
	$line = trim($line);
	if ($line === '' || str_starts_with($line, 'ip_start')) continue;

	[$startIp, $endIp, $country] = str_getcsv($line);
	if (!filter_var($startIp, FILTER_VALIDATE_IP) || !filter_var($endIp, FILTER_VALIDATE_IP)) continue;

	if (!filter_var($startIp, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4) || 
    !filter_var($endIp, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4)) continue;

	$file = "$tmpDir/$country.txt";
	file_put_contents($file, "$startIp,$endIp\n", FILE_APPEND);
}
fclose($fp);
echo "阶段一完成：已按国家拆分 IP 范围文件。\n";
```
